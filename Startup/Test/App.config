<?xml version="1.0"?>
<configuration>

  <configSections>
    <sectionGroup name="soaConfigGroup">
      <section name="businessFileConfig" type="System.Configuration.DictionarySectionHandler" allowLocation="true" allowDefinition="Everywhere"/>
      <section name="filterConfig" type="System.Configuration.DictionarySectionHandler" allowLocation="true" allowDefinition="Everywhere"/>
      <section name="log4net" type="System.Configuration.IgnoreSectionHandler"/>
    </sectionGroup>
  </configSections>

  <!--<appSettings>
    <add key="ConnectionString" value="server=WHZD011630;database=WZHS;uid=WZHSTest;pwd=test"/>
    <add key="DBType" value="MSSQL"/>
    <add key="WebServiceURL" value="http://223.4.201.125/WebServicePool/WebServicePool.asmx?op=Call"/>
  </appSettings>-->
  <startup>
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.5"/>
  </startup>

  <system.serviceModel>
    <bindings>
      <basicHttpBinding>
        <binding name="basicBinding"
                 maxReceivedMessageSize="2147483647"
                 maxBufferPoolSize="524288"
                 closeTimeout="00:01:00"
                 openTimeout="00:01:00"
                 receiveTimeout="00:10:00"
                 sendTimeout="00:01:00">
        </binding>
        <binding name="secureHttpBinding">
          <security mode="Transport">
            <transport clientCredentialType="None"/>
          </security>
        </binding>
      </basicHttpBinding>
    </bindings>
    <services>
      <service name="SOAFramework.Service.Server.SOAService">
        <endpoint address="Http://localhost/Service" binding="webHttpBinding" contract="SOAFramework.Service.Server.IService" bindingName="basicBinding" />
      </service>
    </services>
    <behaviors>
      <endpointBehaviors>
        <behavior name="webHttp">
          <dataContractSerializer maxItemsInObjectGraph="2147483647"/>
          <webHttp/>
        </behavior>
      </endpointBehaviors>
      <serviceBehaviors>
        <behavior>
          <dataContractSerializer maxItemsInObjectGraph="2147483647" />
          <!-- To avoid disclosing metadata information, set the value below to false and remove the metadata endpoint above before deployment -->
          <serviceMetadata httpGetEnabled="true"/>
          <!-- To receive exception details in faults for debugging purposes, set the value below to true. Set to false before deployment to avoid disclosing exception information -->
          <serviceDebug includeExceptionDetailInFaults="true"/>
        </behavior>
      </serviceBehaviors>
    </behaviors>
    <serviceHostingEnvironment aspNetCompatibilityEnabled="true"/>
  </system.serviceModel>

  <soaConfigGroup>
    <businessFileConfig>
      <add key="Test" value="SOAFramework.Service.Server"></add>
    </businessFileConfig>
    <filterConfig>
      <add key="Test" value="SOAFramework.Service.Server"></add>
    </filterConfig>
  </soaConfigGroup>
  <log4net>
    <logger name="loggerAX">
      <!--control log level: ALL|DEBUG|INFO|WARN|ERROR|FATAL|OFF-->
      <!--如果没有定义LEVEL的值，则缺省为DEBUG-->
      <level value="ALL" />
      <appender-ref ref="SmtpAppenderAX"></appender-ref>
      <appender-ref ref="FileAppenderAX"></appender-ref>
    </logger>

    <appender name="SmtpAppenderAX" type="log4net.Appender.SmtpAppender">
      <to value="To@domain.com"></to>
      <from value="From@domain.com" />
      <subject value="AX'Test Log Message" />
      <smtpHost value="mail.eshinfo.com" />
      <username value="eshinfo" />
      <password value="eshinfo" />
      <bufferSize value="2048" />
      <!--超长部分是否丢弃-->
      <lossy value="false" />
      <!--输出级别在WARN和OFF之间的日志-->
      <filter type="log4net.Filter.LevelRangeFilter">
        <param name="LevelMin" value="WARN" />
        <param name="LevelMax" value="OFF" />
      </filter>

      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%newline%date [%thread] %-5level %logger [%property{NDC}] : %newline%message%newline" />
      </layout>

    </appender>

    <appender name="FileAppenderAX" type="log4net.Appender.RollingFileAppender">
      <!--绝对路径-->
      <!--相对路径,在项目的根目录下-->
      <!--以最后一个路径为准,所以上面的绝对路径下不会写日志-->
      <!--防止多线程时不能写Log,官方说线程非安全-->
      <!--实际使用时,本地测试正常,部署后有不能写日志的情况-->
      <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
      <appendToFile value="true" />
      <!--可以为:Once|Size|Date|Composite-->
      <!--Composite为Size和Date的组合-->
      <rollingStyle value="composite" />
      <!--日志最大个数,都是最新的-->
      <!--rollingStyle节点为Date时,该节点不起作用-->
      <!--rollingStyle节点为Size时,只能有value个日志-->
      <!--rollingStyle节点为Composite时,每天有value个日志-->
      <maxSizeRollBackups value="10" />
      <!--当备份文件时,为文件名加的后缀-->
      <!--后缀为*.txt时,例:AX.txt_2008-07-24.PxP 应该是程序上的一个bug-->
      <!--后缀为*.TXT时,例:AX.txt_2008-07-25.TXT-->
      <datePattern value="_yyyy-MM-dd.TXT" />
      <!--可用的单位:KB|MB|GB-->
      <!--不要使用小数,否则会一直写入当前日志-->
      <maximumFileSize value="2048KB" />
      <!--置为true,当前最新日志文件名永远为file节中的名字-->
      <staticLogFileName value="true" />
      <!--输出级别在INFO和ERROR之间的日志-->
      <filter type="log4net.Filter.LevelRangeFilter">
        <param name="LevelMin" value="INFO" />
        <param name="LevelMax" value="ERROR" />
      </filter>
      <!--必须结合起来用,第一个只过滤出WARN,第二个拒绝其它其它日志输出-->
      <filter type="log4net.Filter.LevelMatchFilter">
        <param name="LevelToMatch" value="WARN" />
      </filter>
      <filter type="log4net.Filter.DenyAllFilter" />

      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%date [%thread] %-5level %logger [%ndc] - %message%newline" />
      </layout>
    </appender>
  </log4net>
</configuration>
